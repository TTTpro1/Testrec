name: Subfinder Scan & Telegram Notify

on:
  schedule:
    - cron: "0 */5 * * *" # every 5 hours
  workflow_dispatch:

jobs:
  subfinder:
    runs-on: ubuntu-latest

    steps:
      - name: Run subfinder
        uses: projectdiscovery/subfinder-action@v2
        with:
          domain: ${{ secrets.TARGET_DOMAIN }}
          silent: true
          output: results.txt

      - name: Send results to Telegram
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          if [ -s results.txt ]; then
            MESSAGE=$(sed ':a;N;$!ba;s/\n/%0A/g' results.txt)
            curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
              -d chat_id="${CHAT_ID}" \
              -d text="üîç Subfinder Results:%0A${MESSAGE}"
          else
            curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
              -d chat_id="${CHAT_ID}" \
              -d text="‚ÑπÔ∏è Subfinder ran, but no subdomains were found."
          fi
